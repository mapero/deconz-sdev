name: ctrlx-deconz # you probably want to 'snapcraft register <name>'
base: core18 # the base snap is the execution environment for this snap
summary: deconz # 79 char long summary
description: |
  deconz
version: 2.05.88
grade: devel # must be 'stable' to release into candidate/stable channels
confinement: strict # use 'strict' once you have the right plugs and slots

parts:
  configs:
    source: ./configs
    plugin: dump
    organize:
      'package-assets/*': package-assets/${SNAPCRAFT_PROJECT_NAME}/
  deconz:
    source: http://deconz.dresden-elektronik.de/ubuntu/stable/deconz-2.05.88-qt5.deb
    plugin: dump
    source-type: deb
    stage-packages:
    - qt5-default
    - curl
    - kmod
    - libcap2-bin
    - libqt5core5a
    - libqt5gui5
    - libqt5network5
    - libqt5serialport5
    - libqt5sql5
    - libqt5websockets5
    - libqt5widgets5
    - lsof
    - sqlite3
    - tigervnc-standalone-server
    - tigervnc-common
    - xfonts-base
    - xfonts-scalable
  configs:
    source: ./configs
    plugin: dump
    organize:
      'package-assets/*': package-assets/${SNAPCRAFT_PROJECT_NAME}/
  scripts:
    source: ./scripts
    plugin: dump
    organize:
      '*': bin/

apps:
  deCONZ:
    command: bin/start.sh
    daemon: simple
    plugs: [network-bind, network, raw-usb, browser-support]
    environment:
      LD_LIBRARY_PATH: $SNAP/usr/lib/${SNAPCRAFT_ARCH_TRIPLET}:$LD_LIBRARY_PATH
      QT_PLUGIN_PATH: $SNAP/usr/lib/${SNAPCRAFT_ARCH_TRIPLET}/qt5/plugins
      #QT_DEBUG_PLUGINS: 1
      DEBIAN_FRONTEND: noninteractive
      DECONZ_WEB_PORT: 8087
      DECONZ_WS_PORT: 8088
      DEBUG_INFO: 1
      DEBUG_APS: 0
      DEBUG_ZCL: 0
      DEBUG_ZDP: 0
      DEBUG_OTAU: 0
      DECONZ_DEVICE: /dev/ttyACM0
      DECONZ_VNC_MODE: 0
      DECONZ_VNC_DISPLAY: 0
      DECONZ_VNC_PASSWORD: changeme
      DECONZ_VNC_PORT: 5900
      DECONZ_UPNP: 1

plugs:
  conbeeii:
    interface: serial-port
  system-files:
    interface: system-files
    read:
      - /run/udev/data

slots:
  package-assets:
    interface: content
    content: package-assets
    source:
      read:
      - $SNAP/package-assets/${SNAPCRAFT_PROJECT_NAME}

layout:
  /usr/share/deCONZ/webapp:
    bind: $SNAP/usr/share/deCONZ/webapp
  # /usr/bin/GCFFlasher_internal:
  #   bind-file: $SNAP/usr/bin/GCFFlasher_internal